(function(a){a.CDNSpeedTest={};CDNSpeedTest.Test=function(c,b,d){this.url=b||"";this.key=c||"";this.times=d||1;this._startTime=0;this._failedTimes=0;this._result=[];
this._progress=-1;this.ownerList=null;};CDNSpeedTest.Test.prototype={constructor:CDNSpeedTest.Test,_calc:function(){if(this._failedTimes==this.times){return -1;
}var b,c=0;for(b=0;b<this._result.length;b++){c+=this._result[b];}return Math.round(c/(this.times-this._failedTimes));},result:function(){var b=this._calc();
return{key:this.key,url:this.url,testTimes:this.times,failedTimes:this._failedTimes,time:b};},handleEvent:function(d){var c=(new Date()).getTime();switch(d.type){case"load":this._result.push(c-this._startTime);
break;case"error":this._result.push(-1);this._failedTimes++;break;}this._progress++;if(this._progress<this.times){this._step();}else{var b=document.createEvent("Events");
b.initEvent("test.finish",false,false);b.targetObject=this;document.dispatchEvent(b);}},_step:function(){var b=new Image();b.addEventListener("load",this,false);
b.addEventListener("error",this,false);this._startTime=(new Date()).getTime();b.src=this.url+"?t="+this._startTime;},run:function(){if(this._progress!=-1){return;
}this._progress=0;this._step();},reset:function(){this._progress=-1;this._result=[];this._failedTimes=0;}};CDNSpeedTest.TestList=function(){this._list=[];
this._progress=-1;for(i=0;i<arguments.length;i++){this.add(arguments[i]);}};CDNSpeedTest.TestList.prototype={constructor:CDNSpeedTest.TestList,result:function(){var b=[],c;
for(c=0;c<this._list.length;c++){b.push(this._list[c].result());}return b;},handleEvent:function(c){switch(c.type){case"test.error":case"test.finish":this._progress++;
if(this._progress<this._list.length){this._step();}else{var b=document.createEvent("Events");b.initEvent("testlist.finish",false,false);b.targetObject=this;
document.dispatchEvent(b);document.removeEventListener("test.finish",this,false);document.removeEventListener("test.error",this,false);}}},_step:function(){this._list[this._progress].run();
},add:function(){var b;for(b=0;b<arguments.length;b++){this._list.push(arguments[b]);arguments[b].ownerList=this;}},run:function(){if(!this._list.length){return;
}if(this._progress!=-1){return;}this._progress=0;document.addEventListener("test.finish",this,false);document.addEventListener("test.error",this,false);
this._step();},reset:function(){this._progress=-1;for(i=0;i<this._list.length;i++){this._list[i].reset();}}};})(window);